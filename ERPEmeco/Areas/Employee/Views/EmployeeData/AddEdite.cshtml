@model VM.ViewModels.EmployeeVM
@{
    ViewData["Title"] = "Index";
    Layout = "_Layout";
}
<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">الرئيسية/</span>الموظفين </h4>
    
    @using (Html.BeginForm("AddEdite", "EmployeeData", new { area = "Employee" }, FormMethod.Post, true, new { enctype = "multipart/form-data" }))
    {
        @Html.HiddenFor(m => m.Id)

        <div class="row">
            <!-- بيانات الموظف -->
            <div class="col-xxl">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">بيانات الموظف</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">كود الموظف</label>
                            <input class="form-control" name="EmpCode" value="@Model.EmpCode" />
                            @Html.ValidationMessageFor(m => m.EmpCode, "", new { @class = "text-danger" })
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">اسم الموظف</label>
                            <input class="form-control" name="NameAr" value="@Model.NameAr" />
                            @Html.ValidationMessageFor(m => m.NameAr, "", new { @class = "text-danger" })
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">الرقم القومي</label>
                            <input class="form-control" name="Nid" value="@Model.Nid" />
                            @Html.ValidationMessageFor(m => m.Nid, "", new { @class = "text-danger" })
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">صورة البطاقة</label><br />
                            @if (!string.IsNullOrEmpty(Model.NidPath))
                            {
                                <a href="@Model.NidPath" class="btn btn-info mb-2" target="_blank">تحميل البطاقة</a>
                            }
                            <input class="form-control" type="file" name="NidPath" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">البريد الإلكتروني</label>
                            <input class="form-control" name="Email" value="@Model.Email" />
                            @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-danger" })
                        </div>

                        <div class="mb-3">
                            <label class="fw-bold">الرقم السري:</label>
                            <input type="password" class="form-control" name="Password" value="@Model.Password" />
                            @Html.ValidationMessageFor(m => m.Password, "", new { @class = "text-danger" })
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">الهاتف</label>
                            <input class="form-control" name="PhoneNumber" value="@Model.PhoneNumber" />
                            @Html.ValidationMessageFor(m => m.PhoneNumber, "", new { @class = "text-danger" })
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">العنوان</label>
                            <textarea class="form-control" name="AddressAr">@Model.AddressAr</textarea>
                            @Html.ValidationMessageFor(m => m.AddressAr, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>
            </div>

            <!-- بيانات الوظيفة -->
            <div class="col-xxl">
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">البيانات الوظيفية</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">تاريخ التعيين</label>
                            <input type="date" class="form-control" name="AppointmentDate"
                                   value="@(Model.AppointmentDate?.ToString("yyyy-MM-dd"))" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">الإدارة</label>
                            <select class="form-select" name="DepartmentId">
                                <option value="">اختر الإدارة</option>
                                @foreach (var item in ViewBag.ListHrDepartment)
                                {
                                    <option value="@item.Value"
                                            @(item.Value == Model.DepartmentId?.ToString() ? "selected" : "")>
                                        @item.Text
                                    </option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">المحافظة / الفرع</label>
                            <select class="form-select" name="BranchId">
                                <option value="">اختر الفرع</option>
                                @foreach (var item in ViewBag.ListHrBranch)
                                {
                                    <option value="@item.Value"
                                            @(item.Value == Model.BranchId?.ToString() ? "selected" : "")>
                                        @item.Text
                                    </option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">الوظيفة الحالية</label>
                            <select class="form-select" name="CurrentJobId">
                                <option value="">اختر الوظيفة</option>
                                @foreach (var item in ViewBag.ListHrJobs)
                                {
                                    <option value="@item.Value"
                                            @(item.Value == Model.CurrentJobId?.ToString() ? "selected" : "")>
                                        @item.Text
                                    </option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">نوع الموظف</label><br />
                            @foreach (var item in ViewBag.ListHrEmployeesTypes)
                            {
                                <label class="me-3">
                                    <input type="radio" name="EmployeeTypeId" value="@item.Value"
                                           @(item.Value == Model.EmployeeTypeId.ToString() ? "checked" : "") />
                                    @item.Text
                                </label>
                            }
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">الحالة</label><br />
                            <input type="checkbox" name="IsActive" value="true"
                                   @(Model.IsActive ? "checked" : "") />
                            <input type="hidden" name="IsActive" value="false" />
                            <span>نشط</span>
                        </div>

                        <div class="mb-3">
    <label class="form-label fw-bold">ذوي الاعاقة</label><br />

    <input type="checkbox" name="Disability" value="true"
           @((Model.Disability ?? false) ? "checked" : "") />

    <input type="hidden" name="Disability" value="false" />
    <span>اعاقة</span>
</div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-12 text-end">
                <button type="submit" class="btn btn-primary">حفــــظ</button>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        // DepartmentId
        document.getElementById("CurrentBranchDeptText").addEventListener("input", function () {
            const val = this.value.trim();
            const opts = document.querySelectorAll("#CurrentBranchDeptdatalist option");
            let match = Array.from(opts).find(o => o.value.trim() === val);
            document.getElementById("CurrentBranchDeptId").value = match ? match.dataset.id : "";
        });

        // BranchId
        document.getElementById("CurrentBranchText").addEventListener("input", function () {
            const val = this.value.trim();
            const opts = document.querySelectorAll("#CurrentBranchlist option");
            let match = Array.from(opts).find(o => o.value.trim() === val);
            document.getElementById("CurrentBranchId").value = match ? match.dataset.id : "";
        });

        // CurrentJobId
        document.getElementById("CurrentJobText").addEventListener("input", function () {
            const val = this.value.trim();
            const opts = document.querySelectorAll("#ListHrJobsDatalistOptions option");
            let match = Array.from(opts).find(o => o.value.trim() === val);
            document.getElementById("CurrentJobId").value = match ? match.dataset.id : "";
        });
    </script>
}
