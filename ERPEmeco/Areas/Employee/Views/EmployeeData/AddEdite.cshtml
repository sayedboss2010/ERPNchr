@model VM.ViewModels.EmployeeVM
@{

    ViewData["Title"] = "Index";
    Layout = "_Layout";
}
<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">الرئيسية/</span>الموظفين </h4>
    @* @using (Html.BeginForm("AddEdite", "EmployeeData", FormMethod.Post, new { area = "Employee", enctype = "multipart/form-data" })) *@
    @using (Html.BeginForm("AddEdite", "EmployeeData", new { area = "Employee" }, FormMethod.Post, true, new { enctype = "multipart/form-data" }))
    {
         @Html.HiddenFor(m => m.Id)

        <div class="row">

            <!-- بيانات الموظف -->
            <div class="col-xxl">
                <div class="card mb-4">

                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">بيانات الموظف</h5>
                    </div>

                    <div class="card-body">

                        <!-- كود الموظف -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">كود الموظف</label>
                            <input class="form-control" name="EmpCode" value="@Model.EmpCode" />
                        </div>

                        <!-- اسم الموظف -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">اسم الموظف</label>
                            <input class="form-control" name="NameAr" value="@Model.NameAr" />
                        </div>

                        <!-- الرقم القومي -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">الرقم القومي</label>
                            <input class="form-control" name="Nid" value="@Model.Nid" />
                        </div>

                        <!-- تحميل البطاقة -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">صورة البطاقة</label><br />

                            @if (!string.IsNullOrEmpty(Model.NidPath))
                            {
                                <a href="~/Uploads/NID/@Model.NidPath"
                                   class="btn btn-info mb-2" target="_blank">
                                    تحميل البطاقة
                                </a>
                            }

                            <input class="form-control" type="file" name="Nid_File" />
                        </div>

                        <!-- البريد -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">البريد الإلكتروني</label>
                            <input class="form-control" name="Email" value="@Model.Email" />
                        </div>
                        <!-- البريد -->
                        <div class="mb-3">
 <div class="mb-3">
                        <label class="fw-bold">الرقم السري:</label>
                        <input type="password" class="form-control" name="Password" value="@Model.Password" />
                    </div>
                        </div>
                        <!-- الهاتف -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">الهاتف</label>
                            <input class="form-control" name="PhoneNumber" value="@Model.PhoneNumber" />
                        </div>

                        <!-- العنوان -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">العنوان</label>
                            <textarea class="form-control" name="AddressAr">@Model.AddressAr</textarea>
                        </div>

                    </div>
                </div>
            </div>

            <!-- بيانات الوظيفة -->
            <div class="col-xxl">
                <div class="card mb-4">

                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">البيانات الوظيفية</h5>
                    </div>

                    <div class="card-body">

                        <!-- تاريخ التعيين -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">تاريخ التعيين</label>
                            <input type="date" class="form-control" name="AppointmentDate"
                                   value="@(Model.AppointmentDate?.ToString("yyyy-MM-dd"))" />
                        </div>

                        <!-- الإدارة -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">الإدارة</label>
                            <select class="form-select" name="DepartmentId">
                                <option value="">اختر الإدارة</option>
                                @foreach (var item in ViewBag.ListHrDepartment)
                                {
                                    <option value="@item.Value"
                                            @(item.Value == Model.DepartmentId?.ToString() ? "selected" : "")>
                                        @item.Text
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- الفرع -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">المحافظة / الفرع</label>
                            <select class="form-select" name="BranchId">
                                <option value="">اختر الفرع</option>
                                @foreach (var item in ViewBag.ListHrBranch)
                                {
                                    <option value="@item.Value"
                                            @(item.Value == Model.BranchId?.ToString() ? "selected" : "")>
                                        @item.Text
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- الوظيفة -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">الوظيفة الحالية</label>
                            <select class="form-select" name="CurrentJobId">
                                <option value="">اختر الوظيفة</option>
                                @foreach (var item in ViewBag.ListHrJobs)
                                {
                                    <option value="@item.Value"
                                            @(item.Value == Model.CurrentJobId?.ToString() ? "selected" : "")>
                                        @item.Text
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- نوع الموظف -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">نوع الموظف</label><br />
                            @foreach (var item in ViewBag.ListHrEmployeesTypes)
                            {
                                <label class="me-3">
                                    <input type="radio" name="EmployeeTypeId" value="@item.Value"
                                           @(item.Value == Model.EmployeeTypeId.ToString() ? "checked" : "") />
                                    @item.Text
                                </label>
                            }
                        </div>

                        <!-- الحالة -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">الحالة</label><br />
                            <input type="checkbox" name="IsActive" value="true"
                                   @(Model.IsActive ? "checked" : "") />
                            <input type="hidden" name="IsActive" value="false" />
                            <span>نشط</span>
                        </div>

                    </div>
                </div>
            </div>

        </div>

        <!-- زر الحفظ -->
        <div class="row mt-3">
            <div class="col-12 text-end">
                <button type="submit" class="btn btn-primary">حفــــظ</button>
            </div>
        </div>
    }

</div>
@section Scripts {
    <script>

        // DepartmentId
        document.getElementById("CurrentBranchDeptText").addEventListener("input", function () {
            const val = this.value.trim();
            const opts = document.querySelectorAll("#CurrentBranchDeptdatalist option");

            let match = Array.from(opts).find(o => o.value.trim() === val);
            document.getElementById("CurrentBranchDeptId").value = match ? match.dataset.id : "";
        });

        // BranchId
        document.getElementById("CurrentBranchText").addEventListener("input", function () {
            const val = this.value.trim();
            const opts = document.querySelectorAll("#CurrentBranchlist option");

            let match = Array.from(opts).find(o => o.value.trim() === val);
            document.getElementById("CurrentBranchId").value = match ? match.dataset.id : "";
        });

        // CurrentJobId
        document.getElementById("CurrentJobText").addEventListener("input", function () {
            const val = this.value.trim();
            const opts = document.querySelectorAll("#ListHrJobsDatalistOptions option");

            let match = Array.from(opts).find(o => o.value.trim() === val);
            document.getElementById("CurrentJobId").value = match ? match.dataset.id : "";
        });

    </script>

}